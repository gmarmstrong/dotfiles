#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

print_step() {
    printf "\n${GREEN}→${NC} %s\n" "$1"
}

print_error() {
    printf "${RED}✗${NC} %s\n" "$1" >&2
}

# Get the root of the git repository
repo_root=$(git rev-parse --show-toplevel)
cd "${repo_root}"

exit_code=0

# Run nix flake check
print_step "Running nix flake check..."
if ! nix flake check; then
    print_error "Flake check failed"
    exit_code=1
fi

if [[ ${exit_code} -eq 0 ]]; then
    printf "\n%s✓%s All pre-commit checks passed\n" "${GREEN}" "${NC}"
else
    printf "\n%s✗%s Pre-commit checks failed\n" "${RED}" "${NC}"
fi

exit ${exit_code}
